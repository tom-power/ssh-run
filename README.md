# read/write/**_RUN_** scripts over ssh 

[![ci status][badge]][workflow]

[workflow]: https://github.com/tom-power/ssh-run/actions/workflows/go.yml
[badge]: https://img.shields.io/github/actions/workflow/status/tom-power/ssh-run/go.yml?style=flat-round&logo=github&label=CI%20status

You have some **hosts**, and some **scripts** you want to run against them without remembering many/any details..

..me too, so wrote this nonsense and use it most days now, **ymmv**!

![demo](https://github.com/tom-power/ssh-run/blob/main/assets/demo.gif)

## Usage

### Configuration

Hosts will be read from `~/.ssh/config` and all `*.yml` files in `~/.config/ssh-run/`, which have sshRun specific config. 

Use `localhostIs` to give access `localhost` access to the scripts of a `host` in `hosts`.

```yaml
includeSshConfigHosts: true
localhostIs: example
hosts:
  - ip: 192.168.0.1
    user: exampleUser
    name: example
    port: 22
    portTunnel: 1080
    checkRemote: true
```

### Running scripts

Run a script against a configured host like:

`sshRun <hostName> <scriptName>`

to discover/explain hosts/scripts:

```
sshRun hosts
sshRun <hostName> explain
sshRun <hostName> scripts
sshRun <hostName> <scriptName> explain
```

also `sshRun <hostName>` or `sshRun <hostName> ssh` to start an ssh session.

drop `sshRun` from the above using the provided `bash_aliases` + your hosts.

### Writing scripts

Write scripts as you would normally for the target shell.

`$ip`, `$user`, `$hostName`, `$port`, `$portTunnel` will be replaced with host configuration values.

use the following file name convention to indicate how your scripts should be run:

- `<scriptName>.sh` _with no flags_
- `<scriptName>.pty.sh` _with -t_
- `<scriptName>.x11.sh` _with -Y_
- `<scriptName>.local.sh` _locally_

save to the following directories under `.config/ssh-run/scripts` so the script can be found:

- `common`
- `host/<hostName>` also checked on the remote host if `Config.checkRemote` is `true`
- `shared/<sharedDir>` where `sharedDir` is also found in `host/<hostName>`

see scripts [here](https:#github.com/tom-power/ssh-run/tree/main/config/.config/ssh-run/scripts) for examples.

## Installation

The application consists of a shell script `sshRun`, that calls `eval` on commands generated by `_sshRun` 

i.e. `eval "ssh [option] host -c 'command'"`

so you'll need [ssh](https://www.openssh.com/) installed locally, and you'll need be able to [access](https://www.ssh.com/academy/ssh/public-key-authentication) any hosts you configure.

### From sources

Install [golang](https://go.dev/), then to build.

```shell
git clone https://github.com/tom-power/ssh-run &&
cd ./ssh-run &&
sh/setup.sh &&
sh/build.sh
```
to copy scripts to your path.

```shell
cp sh/.install.env.example sh/.install.env &&
nano sh/.install.env && 
sh/install.sh
```

### From release

```shell
wget https://github.com/tom-power/ssh-run/releases/download/latest/release_linuxamd64.tar.gz &&
tar -xvf release_linuxamd64.tar.gz -C release &&
cp ./release/{sshRun,_sshRun} /your/path/
```

### Command completion 

Some scripts to help with command completion in your shell are included the release/sources, example using [oh-my-zsh](https://ohmyz.sh/).

```shell
cp ./release/completions/settings.aliases.sshRun.zsh ~/.oh-my-zsh/custom/ &&
cp ./release/completions/_sshRun ~/.oh-my-zsh/custom/completions/
```

update `~/.oh-my-zsh/custom/settings.aliases.sshRun.zsh` with host names from `~/.config/ssh-run/*.yml`.
