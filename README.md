# read/write/**_RUN_** scripts over ssh 

[![ci status][badge]][workflow]

[workflow]: https://github.com/tom-power/ssh-run/actions/workflows/go.yml
[badge]: https://img.shields.io/github/actions/workflow/status/tom-power/ssh-run/go.yml?style=flat-round&logo=github&label=CI%20status

You have some **hosts**, and some **scripts** you want to run against them without remembering many/any details..

..me too, so wrote this nonsense and use it most days now, **ymmv**!

![demo](https://github.com/tom-power/ssh-run/blob/main/assets/demo.gif)

## Usage

### Host configuration

All `*.yml` files in `~/.config/ssh-run/` will be read as config.

```yaml
hosts:
  - ip: 192.168.0.1
    user: exampleUser
    name: example
    port: 22
    portTunnel: 1080
    checkRemote: true      
includeSshConfigHosts: true # add host from ~/.ssh/config
localhostIs: example # alias localhost to this host
```

### Writing scripts

Write scripts as you would normally for the shell.

`$ip`, `$user`, `$hostName`, `$port`, `$portTunnel` will be replaced with host configuration values.

use the following file name convention to indicate how your scripts should be run:

- `<scriptName>.sh` _with no flags_
- `<scriptName>.pty.sh` _with -t_
- `<scriptName>.x11.sh` _with -Y_
- `<scriptName>.local.sh` _locally_

save to these directories under `.config/ssh-run/scripts` to link the script to a host:

- `common`
- `host/<hostName>` also checked on the remote host if `Config.checkRemote` is `true`
- `shared/<sharedDir>` where `sharedDir` is also found in `host/<hostName>`

see scripts [here](https:#github.com/tom-power/ssh-run/tree/main/config/.config/ssh-run/scripts) for examples.

### Running scripts

```
Usage:
  sshRun <(hosts|host|-h|--help)> <(scripts|script|ssh|explain)> [explain]

Commands:  
  sshRun hosts                  List hosts
  sshRun host scripts           List scripts on host
  sshRun host script            Run script against host
  sshRun host <ssh>             ssh to host
  sshRun host explain           Explain host
  sshRun host script explain    Explain script

Options:
  -h --help     Show this screen
```

alias `sshRun host` in `settings.aliases.sshRun.zsh`.

## Installation

The application consists of a shell script `sshRun`, that calls `eval` on commands generated by `_sshRun` 

i.e. `eval "ssh -p 22 user@127.0.0.1 -t \"command\""`

so you'll need [ssh](https://www.openssh.com/) installed locally, and you'll need be able to [access](https://www.ssh.com/academy/ssh/public-key-authentication) any hosts you configure over [ssh](https://www.openssh.com/).

### From sources

Install [golang](https://go.dev/), then to build.

```shell
git clone https://github.com/tom-power/ssh-run &&
cd ./ssh-run &&
sh/setup.sh &&
sh/build.sh
```
to copy scripts to your path.

```shell
cp sh/.install.env.example sh/.install.env &&
nano sh/.install.env && 
sh/install.sh
```

### From release

```shell
wget https://github.com/tom-power/ssh-run/releases/download/latest/release_linuxamd64.tar.gz &&
tar -xvf release_linuxamd64.tar.gz -C release &&
cp ./release/{sshRun,_sshRun} /your/path/
```

### Command completion 

Some scripts to help with shell command completion are included the release/sources, example using [oh-my-zsh](https://ohmyz.sh/), [fzf-tab](https://github.com/Aloxaf/fzf-tab) is not required but great.

```shell
cp ./release/completions/settings.aliases.sshRun.zsh ~/.oh-my-zsh/custom/ &&
cp ./release/completions/_sshRun ~/.oh-my-zsh/custom/completions/
```

update `~/.oh-my-zsh/custom/settings.aliases.sshRun.zsh` with host names from `~/.config/ssh-run/*.yml`.
