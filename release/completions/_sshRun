#compdef sshRun

_completions=()

_withHostNames() {
  _completions=$(~/bin/sshRun --hosts)
}

host=""
_withScriptNames() {
  _completions=($(~/bin/sshRun $host --scripts))
}

_withSsh() {  
  _completions+=('--ssh')
}

_withExplain() {  
  _completions+=('--explain')
}

_addCompletions() {
  compadd - $_completions
}

_hostNames() {
  _withHostNames
  _addCompletions
}

_scriptNamesAndhostNameOptions() {
  host=${words[2]}
  _withScriptNames
  _withSsh
  _withExplain
  _addCompletions
}

_scriptNameOptions() {  
  scriptName=${words[3]}
  if [[ $scriptName != '--explain' ]]; then
    _withExplain
    _addCompletions
  fi
}

_arguments -s \
  '1:hostName:_hostNames' \
  '2:scriptName:_scriptNamesAndhostNameOptions' \
  '3:scriptNameOptions:_scriptNameOptions'
